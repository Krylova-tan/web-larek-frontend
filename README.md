# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

# Описание проекта

## Подход к разработке 

В основе этого проекта лежит событийно-ориентированный подход. Это значит, что компоненты приложения взаимодействуют друг с другом посредством обмена сообщениями, которые запускаются при наступлении определённых событий.

Кроме того, в проекте используется архитектурная модель MVP (Model-View-Presenter), которая разделяет приложение на три основных слоя:

- Слой модель — отвечает за управление данными и бизнес-логику;
- Слой представления — отображает данные и передаёт действия пользователя презентеру;
- Слой презентер — получает данные из модели, готовит их для отображения в представлении и обрабатывает ввод данных пользователем.

# Базовые классы

## Класс Api

Базовый класс отвечает за отправку и получение запросов с сервера. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

constructor(baseUrl: string, options: RequestInit = {}) - принимает url сервера, по которому будут происходить запросы и общие опции для этих запросов.

Поля:

- baseUrl - базовый адрес сервера
- options - объект с заголовками запросов

Методы:

- handleResponse - принимает ответ от сервера как параметр, и обрабатывает его, возвращая результат в формате json или отклоненный промис с возникшей ошибкой

- get - выполняет GET запрос на переданный в параметрах адрес и возвращает промис с объектом, которым ответил сервер

- post - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на переданный адрес как параметр


## Класс EventEmitter

Это классическая реализация брокера событий. Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

constructor() - инициализирует брокер событий

Поля:

- _events - Map, состоящий из ивентов и подписчиков

Методы:

- on - устанавливает обработчик на событие
- off - снимает обработчики с события
- emit - инициализирует событие с данными
- onAll - слушает все события сразу
- offAll - сбрасывает всех обработчиков
- trigger - генерирует событие при вызове

## Класс Component ```<T>```

Абстрактный класс дженерик, является родителем всех компонентов слоя представления. Не требует интерфейса. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте.

constructor(container: HTMLElement) - принимает элемент контейнера, в который будет помещен компонент

Методы: 

- toggleClass — метод переключения класса элемента
- setText — метод установки текста элемента
- setDisabled — блокирует или разблокирует переданный элемент в зависимости от значения state - (true/false)
- setHidden — метод для скрытия элемента
- contentText — текст для переданного элемента
- setImage — установка изображения элемента с альтернативным текстом
- render — метод слияния входящих данных и отрисовки элемента

# Компоненты модели данных (Model)

## Класс AppLarekApi

Класс отвечает за работу с сервером в приложении. Наследует базовый класс Api, что позволяет использовать и дополнять его функционал.

Поля:

- cdn — хранит входящий url

Методы:

- getProductList — метод для получения списка товаров с сервера
- getProduct - метод для получения одного товара
- orderDataProducts — метод для отправки данных заказа на сервер


## Класс AppState

Является моделью данных приложения в целом, его состояние. Данный класс содержит в себе все основные данные приложения и методы работы с ними.

Поля:

- catalog — все карточки товара
- basket — состояние счетчика корзины
- preview — данные товара открытые в превью
- order - данные заказа, который отправляется на сервер
- formErrors - данные об ошибках формы

Методы:

- setProducts — установка всех карточек в каталог
- addProductBasket — добавление товара в корзину
- deleteProductBasket — удаление товара из корзины
- setPreview - установка данных в превью
- checkIdInbasket - проверка добавлен товар в корзину
- clearBasket - очистка корзины
- checkValidAddress - валидация первого шага заказа
- checkValidContact — валиадация полей второго шага заказа
- clearInputOrder — очищение полей формы заказа
- setOrderField - для установки поля заказа
- setContactsField - для установки поля контактов

# Компоненты представления (View)

## Класс Product

Класс отвечает за отображение карточки товара, задавая в карточке данные названия, изображения, описания, цены, категории и кнопку. Класс Product расширяет базовый абстрактный класс Component```<T>``` своими полями и методами по интерфейсу IProduct.

constructor(container: HTMLElement, actions?: IActions) - конструктор принимает container типа HTMLElement в котором будет размещен элемент и опциональный объект события actions типа IActions, который содержит действия, которые могут быть выполнены в ответ на события в карточке.

```
interface IActions {
  onClick: (event: MouseEvent) => void;
}
```

В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия пользователя, генерируются соответствующие события. Также в классе есть сеттеры и геттеры для установки и получения значений.

Поля:

- title - хранит разметку заголовка товара
- description - хранит описание товара
- price - хранит разметку цены товара
- category - хранит разметку категории товара
- image - хранит разметку изображения товара
- button - хранит кнопку товара

Все перечисленные поля класса карточки имеют тип HTMLElement. Также класс Product содержит опциональные поля: "description", "image", "category", так как в зависимости от отображения карточки меняются поля.

Методы:

set title — установка содержимого заголовка
set category — установка содержимого категории
set image — установка содержимого изображения
set price — установка содержимого цены
set id - установка id товара

## Класс Page

Класс отвечает за отображение главной страницы, которая состоит из каталога товара и счетчика корзины. 

constructor(container: HTMLElement, protected events: IEvents):
- принимает container типа HTMLElement и объект event типа IEvent
- передает container в родительский конструктор
- сохраняет необходимые элементы разметки в полях
- вешает на кнопку корзины _basket слушатель события click, при котором регистрируется событие basket:open

Поля:

- protected _counter: HTMLElement - счётчик
- protected _catalog: HTMLElement - каталог с карточками товара
- protected _wrapper: HTMLElement - обертка на странице
- protected _basket: HTMLElement - корзина на странице

Набор сеттеров, отвечающих за DOM-элементы главной страницы:

- set counter(value: number) - меняет содержимое счётчика 
- set catalog(items: HTMLElement[]) - меняет содержимое каталога 
- set locked(value: boolean) - меняет класс обёртки

## Класс Basket

Класс отвечает за отображение корзины. Класс включает методы установки товаров и общую сумму товаров. Наследует абстрактный класс Component```<T>``` по интерфейсу IBasket.

constructor(container: HTMLElement, protected events: EventEmitter):
- принимает container типа HTMLElement и объект event типа IEvent
- передает container в родительский конструктор
- сохраняет необходимые элементы разметки в полях
- если есть button, вешает на нее слушатель click с регистрацией события order:open в качестве колбека

Поля:

- protected _list: HTMLElement;
- protected _total: HTMLElement;
- protected _button: HTMLElement;

Методы:

- set total(total: number): void - меняет значение суммы
- set items(items: HTMLElement[]): void - меняет содержимое корзины
- set selected(items: string[]):void; - меняет активность кнопки

## Класс OrderForm

Отвечает за отображение первого шага заказа в модальном окне, а именно выбор способа оплаты и ввод адреса. Класс OrderForm наследует класс Form<T> по типу TOrderForm.

constructor(container: HTMLFormElement, events: IEvents) - принимает контейнер с формой и брокер событий

Методы:

set payment — устанавливает класс активности на кнопку
set address — устанавливает значение поля адреса

## Класс ContactsForm

Отвечает за отображение второго шага заказа в модальном окне, а именно ввод почты и телефона. Класс Contacts наследует класс Form<T> по типу TContactsForm.

constructor(container: HTMLFormElement, events: IEvents) - принимает контейнер с формой и брокер событий

Методы

set phone — устанавливает значение поля телефона
set email — устанавливает значение поля почты

## Класс Modal

Класс отвечает за реализацию модальных окон: позволяет открывать и закрывать модальное окно, а также управлять его содержимым. Является коробкой для любого содержимого. Обработчики событий обеспечивают удобное взаимодействие с пользователем, позволяя закрывать модальное окно как по клику на кнопку, так и по клику вне его содержимого.

- constructor(container: HTMLElement, protected events: IEvents) - конструктор принимает контейнер и экземпляр класса `EventEmitter` для инициации событий при изменении данных

Поля:

- protected _closeButton: HTMLButtonElement - хранит ссылку на кнопку закрытия модального окна
- protected _content: HTMLElement - хранит ссылку на элемент, который будет содержать контент модального окна

Методы: 

- set content(value: HTMLElement) - сеттер для установки содержимого модального окна
- open() - для открытия модального окна
- close() - для закрытия модального окна
- render(data: IModal): HTMLElement - метод для рендеринга модального окна

## Класс Success

Класс отвечает за отображение успешного оформления заказа в модальном окне. Расширяется базовым абстрактным классом Component```<T>``` по интерфейсу ISuccess.

- constructor(container: HTMLElement, actions: ISuccessActions) - в конструкторе есть: элемент, в котором будет размещен компонент и объект, содержащий действия, которые могут быть выполнены в ответ на события в компоненте.

Поля:

total — разметка общей суммы товаров в заказе
close — разметка кнопки закрытия окна

## Класс Form```<T>```

Отвечает за основные способы работы с формой и ее валидацию. Класс является дженериком и принимает в переменной ```<T>``` тип данных компонента отображения. Класс расширяет базовый абстрактный класс Component```<T>``` по интерфейсу IFormState.

Поля:

- protected _submit: HTMLButtonElement - свойство хранит ссылку на кнопку отправки формы
- protected _errors: HTMLElement - свойство хранит ссылку на элемент, который будет отображать ошибки валидации формы

constructor(protected container: HTMLFormElement, protected events: IEvents) - конструктор принимает контейнер и экземпляр класса `EventEmitter` для инициации событий при изменении данных

Методы:

- protected onInputChange(field: keyof T, value: string) - регистрирует событие с именем конкретного поля
- render(state: Partial<T> & IFormState) - метод для рендеринга формы. Он принимает состояние формы, включая валидность и ошибки, и обновляет соответствующие свойства
- сеттер для установки состояния валидности формы
- сеттер для установки текста ошибок валидации

# Презентер (Presenter)

Слой отвечает за взаимодействие модели данных и модели отображения, находится в файле index.ts. Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в index.ts. 
В index.ts сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий

## События изменения данных (генерируются из модели данных)

- items:change - изменение массива товаров каталога
- preview:change - изменение товара в модальном окне
- basket:change - изменение списка товаров в корзине
- order:ready - готовность заказа
- formErrors:changed - необходима очистка данных выбранной для показа в модальном окне карточки

## События интерфейса (генерируются из классов представления)

- card:select - выбор карточки
- basket:open - открытие модального окна корзины
- modal:open - открытие любого модального окна
- modal:close - закрытие любого модального окна
- order:open - открытие окна оформления заказа
- ${form}:submit - отправка формы с кастомным названием
- ${form}.${field}:change - изменение поля с кастомным названием в форме с кастомным названием

## Основные типы и интерфейсы

- IProduct - интерфейс со всеми данными товара
- IOrderResult - модель для успешного оформления заказа
- IOrder -  с общими типами данных заказа

- TOrderForm - данные заказа, используемые в форме при выборе способа оплаты и адреса доставки 
- TContactsForm - данные заказа, используемые в форме при указании почты и номера телефона
- TFormErrors - данные заказа, используемые в форме при обработке ошибок
- TOrder - данные заказа для отправки на сервер
- TBasket - данные корзины с общей стоимостью товаров  


