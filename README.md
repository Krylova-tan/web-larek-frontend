# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

# Описание проекта

## Подход к разработке 

В основе этого проекта лежит событийно-ориентированный подход. Это значит, что компоненты приложения взаимодействуют друг с другом посредством обмена сообщениями, которые запускаются при наступлении определённых событий.

Кроме того, в проекте используется архитектурная модель MVP (Model-View-Presenter), которая разделяет приложение на три основных слоя:

- Слой модель — отвечает за управление данными и бизнес-логику;
- Слой представления — отображает данные и передаёт действия пользователя презентеру;
- Слой презентер — получает данные из модели, готовит их для отображения в представлении и обрабатывает ввод данных пользователем.

# Базовые классы

## Класс Api

Базовый класс отвечает за отправку и получение запросов с сервера. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

constructor(baseUrl: string, options: RequestInit = {}) - принимает url сервера, по которому будут происходить запросы и общие опции для этих запросов.

Поля:

- baseUrl - базовый адрес сервера
- options - объект с заголовками запросов

Методы:

- handleResponse - принимает ответ от сервера как параметр, и обрабатывает его, возвращая результат в формате json или отклоненный промис с возникшей ошибкой

- get - выполняет GET запрос на переданный в параметрах адрес и возвращает промис с объектом, которым ответил сервер

- post - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на переданный адрес как параметр


## Класс EventEmitter

Это классическая реализация брокера событий. Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

constructor() - инициализирует брокер событий

Поля:

- _events - Map, состоящий из ивентов и подписчиков

Методы:

- on - устанавливает обработчик на событие
- off - снимает обработчики с события
- emit - инициализирует событие с данными
- onAll - слушает все события сразу
- offAll - сбрасывает всех обработчиков
- trigger - генерирует событие при вызове

## Класс Component ```<T>```

Абстрактный класс дженерик, для создания компонентов пользовательского интерфейса. Не требует интерфейса. Наследуем в класах слоя представления.

constructor(container: HTMLElement)- принимает элемент контейнера, в который будет помещен компонент

Методы:

- toggleClass — метод переключения класса элемента
- setText — метод установки текста элемента
- setDisabled — блокирует или разблокирует переданный элемент в зависимости от значения state -(true/false)
- setHidden — метод для скрытия элемента
- contentText — текст для переданного элемента
- setImage — установка изображения элемента с альтернативным текстом
- render — метод слияния входящих данных и отрисовки элемента

## Класс Model ```<T>```

Абстрактный класс дженерик, для расширения родительского класса Component```<T>``` и метода привязки события. 

constructor() - принимает на вход объект данных неявного типа и объект события типа IEvent

Методы:

- emmitChanges - метод сообщает об изменении модели

# Компоненты модели данных (Model)

## Класс AppLarekApi

Класс отвечает за работу с сервером в приложении. Наследует базовый класс Api, что позволяет использовать и дополнять его функционал.

Поля:

- cdn — хранит входящий url

Методы:

- getProductList — метод для получения списка товаров с сервера
- orderDataProducts — метод для отправки данных заказа на сервер
- getProduct - метод для получения одного товара

## Класс AppState

Является моделью данных приложения в целом. Данный класс содержит в себе все основные данные приложения и методы работы с ними. Состояние приложения.

Поля:

- catalog — все карточки товара
- basket — состояние счетчика корзины
- preview — данные товара открытые в превью
- order - данные заказа, который отправляется на сервер

Методы:

- setProducts — установка всех карточек в каталог
- addProductBasket — добавление товара в корзину
- deleteProductBasket — удаление товара из корзины
- getIdProduct - получение id товара
- checkIdInbasket — проверка добавлен товар в корзину по его id
- clearBasket — очищение корзины после оформления заказа
- checkValidAdress — валидация адреса, введенного в форму
- checkValidContact — валиадация полей с контактами пользователя
- clearInputOrder — очищение полей формы
- getTotal — подсчет общей суммы товаров 

Также будут использоваться геттеры и сеттеры получения и установки данных в поля объекта.

# Компоненты представления (View)

## Класс Product

Класс отвечает за отображение данных карточки товара и имеет опциональные поля. Расширяется базовым абстрактным классом Component```<T>``` по интерфейсу IProduct.

constructor(template: HTMLElement, action: IActions) - в конструктор передается шаблон элемента и событие. Также понадобятся сеттеры и геттеры для установки значения поля объекта. 

В полях класса хранятся следующие данные:

- id - id товара
- title - заголовок товара
- description - описание
- price - цена товара
- category - категория товара
- image - изображение товара

## Класс Page

Класс отвечает за отображение главной страницы, которая состоит из каталога товара и счетчика корзины. Класс включает методы установки значения в счетчике товаров корзины и установки каталога на страницу.

```
interface IPage {
  catalog: HTMLElement[];
  counter: HTMLElement;
}
```

## Класс Basket

Класс отвечает за отображение корзины в модальном окне. Класс включает методы установки товаров и общую сумму товаров. Расширяется базовым абстрактным классом Component```<T>``` по интерфейсу IBasket. Класс содержит метод переключения статуса кнопки.

```
interface IBasket {
  items: HTMLElement[];
  total: number;
}
```

## Класс Order

Класс отвечает за реализацию компонента формы отправки заказа, содержит опциональные поля. Класс реализован по интерфейсу IOrder. Также класс сожердит сеттеры для установки значения полей "pay", "addres", "phone", "email".

```
interface IOrder {
  pay: PaymentMethod;
  addres: string;
  phone: string;
  email: string;
  items?: string[];
  total?: number;
}
```

## Класс Modal

Класс отвечает за реализацию модальных окон. Является коробкой для любого содержимого. Класс реализован по интерфейсу IModal. Также класс содержит методы для открытия, закрытия, отрисовки данных контента и установки контента.

```
interface IModal {
  content: HTMLElement;
  closeButton: HTMLButtonElement;

  openModal():void;
  closeModal():void;
  render(data:HTMLElement):HTMLElement;
  set(value: HTMLElement):void;
}
```

## Класс Success

Класс отвечает за отображение успешного оформления заказа в модальном окне. Расширяется базовым абстрактным классом Component```<T>``` по интерфейсу ISuccess.

```
interface ISuccess {
  total: number;
  buttonClose: HTMLButtonElement;
}
```

## Класс Form```<T>```

Отвечает за основные способы работы с формой и ее валидацию. Класс является дженериком и принимает в переменной ```<T>``` тип данных компонента отображения. Расширяется базовым абстрактным классом Component```<T>``` по интерфейсу IFormState.

```
interface IFormState {
  valid: boolean;
  errors: string[];
}
```

# Презентер (Presenter)

Слой отвечает за взаимодействие модели данных и модели отображения, находится в файле index.ts. Взаимодействие осуществляется через посредника — брокер событий, который отслеживает их.

## События изменения данных (генерируются из модели данных)

- items:change - изменение массива товаров каталога
- preview:change - изменение товара в модальном окне
- basket:change - изменение списка товаров в корзине

## События интерфейса (генерируются из классов представления)

- card:select - выбор карточки
- basket:open - открытие модального окна корзины
- modal:open - открытие любого модального окна
- modal:close - закрытие любого модального окна
- order:open - открытие окна оформления заказа
- ${form}:submit - отправка формы

## Основные типы и интерфейсы

- IProduct - интерфейс со всеми данными товара
- IBasket - интерфейс корзины с общей стоимостью товаров
- IOrder - интерфейс заказа для отправки на сервер
- IOrderResult - интерфейс результата отправки заказа

- TPaymentMethod - тип способа оплаты
- TOrderForm - тип формы заказа
- TContactsForm - тип формы контактов
- TOrder - объединенный тип формы заказа и контактов
- TFormErrors - тип для ошибок формы

